# PR Command Configuration
# Pull Request 자동 생성

extends: "_base.yaml"

# ============================================================================
# COMMAND INFO
# ============================================================================

command: "pr"
type: "utility"
description: "Pull Request 자동 생성 with 템플릿 자동 채우기"

# ============================================================================
# PREREQUISITES
# ============================================================================

prerequisites:
  - gh  # GitHub CLI
  - git

# ============================================================================
# TEMPLATES
# ============================================================================

templates:
  - path: ".claude/templates/git/pr-auto-fill.yaml"
    purpose: "PR 템플릿 자동 채우기 규칙"
  - path: ".claude/templates/git/pr-template.md"
    purpose: "PR 본문 템플릿"
  - path: ".claude/templates/git/pr-sections-map.json"
    purpose: "섹션 매핑"

# ============================================================================
# BASE BRANCH SELECTION
# ============================================================================

prompts:
  base_branch_selection:
    - question: "어느 브랜치로 PR을 생성하시겠습니까?"
      header: "Base 브랜치"
      multiSelect: false
      options:
        - label: "main"
          description: "프로덕션 배포용 브랜치"
        - label: "develop"
          description: "개발 통합 브랜치"
        - label: "기타"
          description: "다른 브랜치 지정"

    - question: "PR을 Draft로 생성하시겠습니까?"
      header: "PR 상태"
      multiSelect: false
      options:
        - label: "일반 PR"
          description: "바로 리뷰 요청 가능한 PR"
        - label: "Draft PR"
          description: "작업 중인 PR (리뷰 요청 전)"

  # 자동 감지 규칙 (참고용, 동적으로 처리)
  # feature/* → develop (high confidence)
  # hotfix/* → main (high confidence)
  # fix/* → develop (medium confidence)

# ============================================================================
# PR AUTO-FILL SETTINGS
# ============================================================================

auto_fill:
  enabled: true

  # 데이터 소스
  sources:
    - type: "spec_file"
      path: ".specify/spec.md"
      priority: 1

    - type: "git_commits"
      format: "grouped_by_type"
      priority: 2

    - type: "tasks_verification"
      path: ".specify/tasks.md"
      priority: 3

  # 섹션별 자동 채우기
  sections:
    changes_detection: true
    description_generation: true
    test_generation: true
    screenshots: "auto_detect_ui_changes"
    references_generation: true
    checklist_validation: true

# ============================================================================
# HOOKS
# ============================================================================

hooks:
  pre_execution:
    - script: ".claude/hooks/pre-command/pr.sh"
      description: "브랜치 상태 확인"
      optional: true

# ============================================================================
# FLAGS
# ============================================================================

flags:
  - name: "--base"
    description: "Base branch 직접 지정"
    example: "/pr --base main"

  - name: "--draft"
    description: "Draft PR 생성"
    example: "/pr --draft"

  - name: "--auto-assign"
    description: "리뷰어 자동 할당"
    example: "/pr --auto-assign"

# ============================================================================
# NEXT COMMANDS (다음 단계 추천)
# ============================================================================

next_commands:
  enabled: true
  auto_prompt: true

  recommendations:
    - command: "/dashboard"
      trigger: "on_success"
      condition: ""  # 항상 추천
      priority: 1
      auto_execute: false
      description: "프로젝트 대시보드를 확인합니다"
