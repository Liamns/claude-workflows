# Claude Workflows - Parallel Orchestrator Configuration
# Version: 1.0.0

# ════════════════════════════════════════════════════════════════════════════
# PARALLEL EXECUTION SETTINGS
# ════════════════════════════════════════════════════════════════════════════

parallel:
  # Enable/disable parallel execution system
  enabled: true

  # Maximum number of agents to run concurrently
  # Recommendation: 3 (based on token limits and resource constraints)
  max_concurrent: 3

  # ══════════════════════════════════════════════════════════════════════════
  # AGENT CLASSIFICATION
  # ══════════════════════════════════════════════════════════════════════════

  agents:
    # Read-only agents (safe for parallel execution)
    parallel_safe:
      - architect-unified
      - reviewer-unified
      - documenter-unified  # Analysis mode only

    # Write agents (require sequential execution)
    sequential_required:
      - api-designer
      - implementer-unified
      - documenter-unified  # Git commit mode

  # ══════════════════════════════════════════════════════════════════════════
  # FAILURE HANDLING
  # ══════════════════════════════════════════════════════════════════════════

  failure_handling:
    # Strategy when parallel execution fails
    # Options: 'fallback' (retry sequentially), 'abort' (stop immediately)
    strategy: fallback

    # Number of retry attempts in sequential mode
    retry_count: 1

    # Delay before retrying (in seconds)
    retry_delay: 2

    # Reuse successful agent results from parallel attempt
    reuse_success: true

    # Alert user about fallback
    notify_user: true

  # ══════════════════════════════════════════════════════════════════════════
  # TIMEOUT SETTINGS
  # ══════════════════════════════════════════════════════════════════════════

  timeouts:
    # Per-agent timeout (in seconds)
    agent: 600  # 10 minutes

    # Total workflow timeout (in seconds)
    workflow: 1800  # 30 minutes

    # Parallel phase timeout (in seconds)
    parallel_phase: 900  # 15 minutes

# ════════════════════════════════════════════════════════════════════════════
# WORKFLOW-SPECIFIC SETTINGS
# ════════════════════════════════════════════════════════════════════════════

workflows:
  # /major workflow optimization
  major:
    enabled: true
    phases:
      - name: validation
        type: parallel
        agents:
          - architect-unified
          - reviewer-unified
          - documenter-unified
        max_concurrent: 3

      - name: api_design
        type: sequential
        agents:
          - api-designer

      - name: implementation
        type: sequential
        agents:
          - implementer-unified

      - name: documentation
        type: sequential
        agents:
          - documenter-unified

  # /minor workflow optimization
  minor:
    enabled: true
    phases:
      - name: validation
        type: parallel
        agents:
          - architect-unified
          - reviewer-unified
        max_concurrent: 2

      - name: fix
        type: sequential
        agents:
          - implementer-unified

  # /review command optimization
  review:
    enabled: true
    phases:
      - name: comprehensive_review
        type: parallel
        agents:
          - reviewer-unified  # Already unified, inherently parallel
        max_concurrent: 1  # Single unified agent

  # /test command optimization
  test:
    enabled: true
    # Conditional parallelization based on test count
    conditional:
      enabled: true
      small_threshold: 5     # < 5 tests → sequential
      medium_threshold: 20   # 5-20 tests → parallel 2
      large_threshold: 21    # > 20 tests → parallel 3

# ════════════════════════════════════════════════════════════════════════════
# CONDITIONAL PARALLELIZATION
# ════════════════════════════════════════════════════════════════════════════

conditional:
  # Enable automatic parallel/sequential decision
  enabled: true

  # Decision criteria
  criteria:
    # Based on changed files count
    changed_files:
      enabled: true
      small: 10      # < 10 files → sequential faster
      medium: 50     # 10-50 files → parallel 2
      large: 51      # > 50 files → parallel 3

    # Based on project size
    project_size:
      enabled: true
      small: 100     # < 100 files → sequential
      medium: 500    # 100-500 files → parallel 2
      large: 501     # > 500 files → parallel 3

    # Based on historical success rate
    success_rate:
      enabled: true
      threshold: 90  # If success rate < 90%, reduce parallelism

# ════════════════════════════════════════════════════════════════════════════
# PROGRESSIVE PARALLELIZATION
# ════════════════════════════════════════════════════════════════════════════

progressive:
  # Enable gradual increase in parallelism
  enabled: false  # Disabled by default (use full parallel immediately)

  # Levels
  levels:
    - level: 1
      max_concurrent: 1
      unlock_criteria:
        success_rate: 0     # Start here

    - level: 2
      max_concurrent: 2
      unlock_criteria:
        success_rate: 85    # Unlock after 85% success
        min_runs: 10        # Minimum 10 runs at level 1

    - level: 3
      max_concurrent: 3
      unlock_criteria:
        success_rate: 95    # Unlock after 95% success
        min_runs: 20        # Minimum 20 runs at level 2

# ════════════════════════════════════════════════════════════════════════════
# CACHE INTEGRATION
# ════════════════════════════════════════════════════════════════════════════

cache:
  # Enable cache-aware parallelization
  enabled: true

  # Share file cache across parallel agents
  share_file_cache: true

  # Share git cache across parallel agents
  share_git_cache: true

  # Cache agent results for reuse
  cache_agent_results: true
  agent_result_ttl: 600  # 10 minutes

# ════════════════════════════════════════════════════════════════════════════
# CONFLICT DETECTION
# ════════════════════════════════════════════════════════════════════════════

conflict_detection:
  # Enable automatic file conflict detection
  enabled: true

  # Check for write conflicts before parallel execution
  precheck: true

  # Automatically serialize conflicting agents
  auto_serialize: true

  # File patterns that indicate potential conflicts
  conflict_patterns:
    - "package.json"
    - "yarn.lock"
    - "*.config.*"

# ════════════════════════════════════════════════════════════════════════════
# MONITORING & LOGGING
# ════════════════════════════════════════════════════════════════════════════

monitoring:
  # Enable performance monitoring
  enabled: true

  # Log parallel execution details
  log_parallel: true

  # Log fallback events
  log_fallback: true

  # Display performance metrics after workflow
  show_metrics: true

  # Save detailed metrics
  save_metrics: true
  metrics_path: .claude/cache/parallel-metrics

  # Metrics to track
  track:
    - execution_time
    - parallel_success_rate
    - fallback_frequency
    - token_savings
    - speed_improvement

# ════════════════════════════════════════════════════════════════════════════
# ALERTS & NOTIFICATIONS
# ════════════════════════════════════════════════════════════════════════════

alerts:
  # Alert when parallel success rate drops below threshold
  success_rate_threshold: 85  # 85%

  # Alert when fallback frequency is too high
  fallback_frequency_threshold: 20  # 20% of runs

  # Alert when speed improvement is below target
  speed_improvement_threshold: 25  # 25% improvement minimum

# ════════════════════════════════════════════════════════════════════════════
# PERFORMANCE TARGETS
# ════════════════════════════════════════════════════════════════════════════

targets:
  # Target parallel execution success rate
  parallel_success_rate: 95  # 95% or higher

  # Target speed improvement (percentage)
  speed_improvement:
    major: 33   # 33% for /major
    minor: 37   # 37% for /minor

  # Target fallback success rate
  fallback_success_rate: 100  # 100% (must always succeed)

  # Target token savings (percentage)
  token_savings: 15  # 15% from avoiding duplicate context loads

# ════════════════════════════════════════════════════════════════════════════
# ADVANCED SETTINGS
# ════════════════════════════════════════════════════════════════════════════

advanced:
  # Dynamic parallelism adjustment
  dynamic_adjustment:
    enabled: false  # Future feature
    adjust_interval: 50  # Adjust every 50 runs
    min_parallel: 1
    max_parallel: 3

  # Background task scheduling
  background_tasks:
    enabled: true
    # Allow documenter-unified analysis in background
    allow_background:
      - documenter-unified  # Analysis mode only

  # Dependency tracking (future feature)
  dependency_tracking:
    enabled: false
    auto_detect: false

  # Resource-based throttling (future feature)
  resource_throttling:
    enabled: false
    max_memory: 4G
    max_cpu: 80

# ════════════════════════════════════════════════════════════════════════════
# EXPERIMENTAL FEATURES
# ════════════════════════════════════════════════════════════════════════════

experimental:
  # Speculative execution (run agents speculatively)
  speculative_execution:
    enabled: false

  # Agent result caching across workflows
  cross_workflow_cache:
    enabled: false

  # Parallel test execution
  parallel_tests:
    enabled: false

# ════════════════════════════════════════════════════════════════════════════
# SAFETY SETTINGS
# ════════════════════════════════════════════════════════════════════════════

safety:
  # Never parallelize these agents (override)
  never_parallel:
    - api-designer
    - implementer-unified

  # Always wait for these agents to complete
  blocking_agents:
    - api-designer  # Others may depend on its output

  # Maximum retries before aborting
  max_total_retries: 2

  # Abort workflow if critical agent fails
  abort_on_critical_failure: true
  critical_agents:
    - implementer-unified

# ════════════════════════════════════════════════════════════════════════════
# DEBUGGING
# ════════════════════════════════════════════════════════════════════════════

debug:
  # Enable debug mode (verbose logging)
  enabled: false

  # Log agent execution details
  log_agent_execution: false

  # Simulate failures for testing
  simulate_failures: false
  failure_rate: 0  # 0% (disabled)

  # Force sequential mode for debugging
  force_sequential: false

# ════════════════════════════════════════════════════════════════════════════
# END OF CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# Notes:
# - Timeouts are in seconds
# - Success rates are in percentages (0-100)
# - Agent names must match exactly
# - Some features marked as "future feature" are planned but not yet implemented
# - Always test configuration changes in non-production environment first

# Configuration validation:
# - max_concurrent must be between 1-3
# - retry_count must be between 0-3
# - All timeout values must be positive
# - success_rate thresholds must be between 0-100
